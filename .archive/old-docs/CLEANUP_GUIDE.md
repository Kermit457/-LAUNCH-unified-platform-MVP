# Safe Codebase Cleanup Guide

**Created:** 2025-10-19
**Status:** Ready to execute
**Safety:** All operations are reversible

---

## Overview

This guide provides a **safe, audited approach** to cleaning up unused mock data, test files, and orphaned code without breaking production functionality.

### What We've Already Cleaned (2025-10-19)

‚úÖ Removed 13 unused API routes (`predictions.unused/`, `social.unused/`)
‚úÖ Deleted ~15 test pages (`test-*`, `design-test/*`)
‚úÖ Archived 91 one-time setup scripts to `archive/scripts/`
‚úÖ Removed duplicate components (`NavBar.tsx`)
‚úÖ Fixed CSP errors in `next.config.js`

---

## Phase 2: Intelligent Cleanup with Audit

### Step 1: Run Health Check (READ-ONLY)

This analyzes which mock files and hooks are actually used:

```powershell
# PowerShell
node scripts/audit-codebase.mjs
```

**What it does:**
- ‚úÖ Scans all mock data files in `lib/`
- ‚úÖ Checks which files import them
- ‚úÖ Identifies unused hooks
- ‚úÖ Generates `AUDIT_REPORT.csv`
- ‚úÖ **NO DELETIONS** - read-only analysis

**Expected Output:**
```
üîç CODEBASE HEALTH CHECK

üìä Mock Data Files Analysis
‚úì USED lib/dashboardMockData.ts
  Referenced by: app/discover/page.tsx
‚úì USED lib/livePitchMockData.ts
  Referenced by: app/live/page.tsx
‚úì USED lib/unifiedMockData.ts
  Referenced by: app/discover/page.tsx
‚úó UNUSED lib/mockNetworkData.ts
‚úó UNUSED lib/mockProfileData.ts
...
```

---

### Step 2: Review Audit Report

Open `AUDIT_REPORT.csv` and verify:
- ‚úÖ Files marked "UNUSED" have 0 references
- ‚úÖ Files marked "USED" show where they're imported
- ‚úÖ You agree with the categorization

---

### Step 3: Safe Archive (DRY RUN)

Test what would be archived without actually moving files:

```powershell
node scripts/safe-archive.mjs
```

**What it does:**
- ‚úÖ Shows which files would be moved to `.archive/`
- ‚úÖ **NO ACTUAL CHANGES** - dry run only
- ‚úÖ Validates all files exist

**Expected Output:**
```
üóÑÔ∏è Safe Archive Script
‚ö† DRY RUN MODE - No files will be moved

‚Ñπ [DRY RUN] Would archive: lib/mockNetworkData.ts ‚Üí .archive/lib/mockNetworkData.ts
‚Ñπ [DRY RUN] Would archive: lib/mockProfileData.ts ‚Üí .archive/lib/mockProfileData.ts
...
```

---

### Step 4: Apply Archive (ACTUAL MOVE)

If dry run looks good, execute the archive:

```powershell
$env:APPLY=1; node scripts/safe-archive.mjs
```

**What it does:**
- ‚úÖ Copies files to `.archive/` directory
- ‚úÖ Deletes originals
- ‚úÖ Preserves directory structure
- ‚úÖ All files are recoverable from `.archive/`

---

### Step 5: Verify & Test

After archiving, verify the app still works:

```powershell
# Clear Next.js cache
Remove-Item -Recurse -Force .next

# Restart dev server
npm run dev
```

**Test these pages:**
- http://localhost:3000/ (landing)
- http://localhost:3000/discover (browse curves)
- http://localhost:3000/launch (create curve)
- http://localhost:3000/earn (campaigns)
- http://localhost:3000/live (live events)
- http://localhost:3000/network (social)

**Expected:** All pages load without errors

---

### Step 6: Commit Changes

If everything works:

```powershell
git add .
git commit -m "chore: archive unused mock files and test hooks

- Archived 6 unused mock data files to .archive/
- Archived 3 unused test hooks
- Kept active mock files (dashboardMockData, livePitchMockData, unifiedMockData)
- All production pages tested and working

Files archived:
- lib/mockNetworkData.ts
- lib/mockProfileData.ts
- lib/mock-data.ts
- lib/leaderboardData.ts
- lib/sampleData.ts
- lib/landingData.ts
- hooks/useSolanaBuyKeysMock.ts
- hooks/useTestSolanaTransaction.ts
- hooks/useSimpleSolanaTransaction.ts

Generated by: scripts/audit-codebase.mjs + scripts/safe-archive.mjs
"
```

---

## Alternative: More Aggressive Cleanup

If you want to do deeper cleanup with dependency analysis:

### Install Advanced Tools

```powershell
npm install -D knip depcheck madge
```

### Run Dependency Analysis

```powershell
# Find unused dependencies
npx depcheck

# Find unused exports/imports
npx knip

# Visualize dependency graph
npx madge --circular --extensions ts,tsx ./app
```

**Warning:** These tools can have false positives. Review carefully.

---

## Files Currently Being Used (Keep These)

### Mock Data (Active)
- ‚úÖ `lib/dashboardMockData.ts` - Used by discover page
- ‚úÖ `lib/livePitchMockData.ts` - Used by live page
- ‚úÖ `lib/unifiedMockData.ts` - Used by discover page
- ‚úÖ `lib/advancedTradingData.ts` - Used by discover page
- ‚úÖ `lib/mockChartData.ts` - Used by launch/[id] page

### Hooks (Active)
- ‚úÖ `hooks/useSyncPrivyToAppwrite.ts` - **CRITICAL** onboarding
- ‚úÖ `hooks/useCreateCurve.ts` - Curve creation
- ‚úÖ `hooks/useSolanaBuyKeys.ts` - Buy transactions
- ‚úÖ `hooks/useSolanaSellKeys.ts` - Sell transactions
- ‚úÖ `hooks/usePrivySolanaTransaction.ts` - Generic signer
- ‚úÖ `hooks/useCurve.ts` - Curve data fetching
- ‚úÖ `hooks/useCurveData.ts` - Curve analytics

---

## Files Safe to Archive (Unused)

### Mock Data (Not Referenced)
- ‚ùå `lib/mockNetworkData.ts` - 0 imports
- ‚ùå `lib/mockProfileData.ts` - 0 imports
- ‚ùå `lib/mock-data.ts` - 0 imports
- ‚ùå `lib/leaderboardData.ts` - 0 imports
- ‚ùå `lib/sampleData.ts` - 0 imports
- ‚ùå `lib/landingData.ts` - 0 imports

### Hooks (Not Referenced)
- ‚ùå `hooks/useSolanaBuyKeysMock.ts` - Mock version
- ‚ùå `hooks/useTestSolanaTransaction.ts` - Test only
- ‚ùå `hooks/useSimpleSolanaTransaction.ts` - Superseded

---

## Rollback Plan

If something breaks after archiving:

### Option 1: Restore Single File

```powershell
# Copy file back from archive
Copy-Item ".archive/lib/mockNetworkData.ts" "lib/mockNetworkData.ts"
```

### Option 2: Restore All Files

```powershell
# Restore entire archive
Copy-Item -Recurse -Force ".archive/*" .
```

### Option 3: Git Revert

```powershell
git revert HEAD
```

---

## Next Steps After Cleanup

### Replace Mock Data with Real Appwrite Queries

For production, replace mock data with real backend calls:

1. **Dashboard Page** - Replace `dashboardMockData` with Appwrite queries
2. **Discover Page** - Replace `unifiedMockData` with real curve data
3. **Live Page** - Replace `livePitchMockData` with real-time data
4. **Chart Data** - Replace `mockChartData` with price history API

**Reference:** See `lib/appwrite/services/` for service implementations

---

## Summary

### Safe Cleanup Process

1. ‚úÖ **Audit** - Run `audit-codebase.mjs` (read-only)
2. ‚úÖ **Review** - Check `AUDIT_REPORT.csv`
3. ‚úÖ **Dry Run** - Run `safe-archive.mjs` (no changes)
4. ‚úÖ **Apply** - Run with `APPLY=1` (actual move)
5. ‚úÖ **Test** - Verify all pages work
6. ‚úÖ **Commit** - Save changes to git

### What Makes This Safe

- ‚úÖ No permanent deletions - files moved to `.archive/`
- ‚úÖ Dry run mode by default
- ‚úÖ Audit report shows exactly what's being removed
- ‚úÖ Git version control for rollback
- ‚úÖ Test validation before commit

---

## Questions?

- **What if audit shows false negatives?** Edit `safe-archive.mjs` to exclude those files
- **Can I delete .archive/ later?** Yes, after thorough testing (1-2 weeks)
- **Will this break production?** No, audit only targets unused files
- **What about dynamic imports?** Audit checks string patterns, may miss some edge cases

---

**Status:** Ready to execute
**Risk Level:** Low (reversible operations)
**Time Required:** 10-15 minutes
